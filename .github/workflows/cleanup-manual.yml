name: Manual Workflow Cleanup
on:
  workflow_dispatch:
    inputs:
      days_old:
        description: '删除多少天前的记录'
        required: false
        default: '30'
        type: number
        
      workflow_name:
        description: '工作流名称（多个用逗号分隔）'
        required: false
        default: ''
        type: string
        
      keep_minimum:
        description: '最少保留记录数'
        required: false
        default: '20'
        type: number

permissions:
  actions: write
  contents: read

jobs:
  cleanup:
    runs-on: ubuntu-latest
    steps:
      - name: Display selected parameters
        run: |
          echo "将要删除的参数配置："
          echo "天数: ${{ github.event.inputs.days_old }}"
          echo "工作流: ${{ github.event.inputs.workflow_name || '所有工作流' }}"
          echo "最少保留: ${{ github.event.inputs.keep_minimum }}"
      
      # 使用推荐的第三方 Action
      - name: Delete workflow runs
        uses: Mattraks/delete-workflow-runs@v2
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          repository: ${{ github.repository }}
          # 删除超过 N 天的记录
          retain_days: ${{ github.event.inputs.days_old }}
          # 或保留最近 N 条记录（二选一）
          # keep_minimum_runs: ${{ github.event.inputs.keep_minimum }}
          # 指定工作流（可选）
          workflow_name: ${{ github.event.inputs.workflow_name }}
